{"version":3,"sources":["../../lib/endpoints/player.es6"],"names":["Player","nodeMailer","req","res","console","log","mailOption","form","IncomingForm","multiples","uploadDir","resolve","on","name","value","to","from","text","file","rename","path","join","fileDetail","attachments","push","err","send","then","resp","statusCode","parse"],"mappings":"AAAA;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;;;;;IAEaA,M,WAAAA,M;AAEX,kBAAYC,UAAZ,EAAwB;AAAA;;AACtB,SAAKA,UAAL,GAAkBA,UAAlB;AACD;;;;8BAESC,G,EAAKC,G,EAAK;AAAA;;AAClBC,cAAQC,GAAR,CAAY,kBAAZ;AACA,WAAKC,UAAL,GAAkB;AAChB;AACA,uBAAe;AAFC,OAAlB;AAIA,UAAIC,OAAO,IAAI,qBAAWC,YAAf,EAAX;;AAEA;AACAD,WAAKE,SAAL,GAAiB,IAAjB;;AAEA;AACAF,WAAKG,SAAL,GAAiB,eAAKC,OAAL,CAAa,SAAb,CAAjB;;AAEAJ,WAAKK,EAAL,CAAQ,OAAR,EAAiB,UAACC,IAAD,EAAOC,KAAP,EAAiB;AAChC,gBAAQD,IAAR;AACE,eAAK,aAAL;AAAoB;AAClB,oBAAKP,UAAL,CAAgBS,EAAhB,GAAqBD,KAArB;AACD;AACD;AACA,eAAK,WAAL;AAAkB;AAChB,oBAAKR,UAAL,CAAgBU,IAAhB,GAAuBF,KAAvB;AACD;AACD;AACA,eAAK,SAAL;AAAgB;AACd,oBAAKR,UAAL,CAAgBW,IAAhB,GAAuBH,KAAvB;AACD;AAXH;AAaD,OAdD;;AAgBAP,WAAKK,EAAL,CAAQ,MAAR,EAAgB,UAACC,IAAD,EAAOK,IAAP,EAAgB;AAC9B,qBAAGC,MAAH,CAAUD,KAAKE,IAAf,EAAqB,eAAKC,IAAL,CAAUd,KAAKG,SAAf,EAA0BQ,KAAKL,IAA/B,CAArB;AACA,YAAIS,aAAa;AACf,sBAAYT,IADG;AAEf,kBAAQ,aAAWA;AAFJ,SAAjB;AAIA,cAAKP,UAAL,CAAgBiB,WAAhB,CAA4BC,IAA5B,CAAiCF,UAAjC;AACD,OAPD;;AASAf,WAAKK,EAAL,CAAQ,OAAR,EAAiB,eAAO;AACtBR,gBAAQC,GAAR,CAAY,6BAA6BoB,GAAzC;AACD,OAFD;;AAIA;AACAlB,WAAKK,EAAL,CAAQ,KAAR,EAAe,YAAM;AACnBR,gBAAQC,GAAR,CAAY,4BAAZ;AACA,cAAKJ,UAAL,CAAgByB,IAAhB,CAAqB,MAAKpB,UAA1B,EACGqB,IADH,CACQ,gBAAQ;AACZvB,kBAAQC,GAAR,CAAY,kCAAZ,EAAgDuB,IAAhD;AACAzB,cAAI0B,UAAJ,GAAiB,GAAjB;AACA1B,cAAIuB,IAAJ,CAASE,IAAT;AACD,SALH,EAKK,eAAO;AACRxB,kBAAQC,GAAR,CAAY,wBAAZ,EAAsCoB,GAAtC;AACAtB,cAAI0B,UAAJ,GAAiB,GAAjB;AACA1B,cAAIuB,IAAJ,CAASD,GAAT;AACD,SATH;AAUD,OAZD;;AAcA;AACAlB,WAAKuB,KAAL,CAAW5B,GAAX;AAED","file":"player.js","sourcesContent":["\"use strict\";\nimport formidable from \"formidable\";\nimport path from \"path\";\nimport fs from \"fs\";\n\nexport class Player {\n\n  constructor(nodeMailer) {\n    this.nodeMailer = nodeMailer;\n  }\n\n  getPlayer(req, res) {\n    console.log(\"GOt post request\");\n    this.mailOption = {\n      // \"from\": \"dav.warne9@gmail.com\",\n      \"attachments\": []\n    };\n    let form = new formidable.IncomingForm();\n\n    // specify that we want to allow the user to upload multiple files in a single request\n    form.multiples = true;\n\n    // store all uploads in the /uploads directory\n    form.uploadDir = path.resolve('uploads');\n\n    form.on('field', (name, value) => {\n      switch (name) {\n        case \"friendEmail\": {\n          this.mailOption.to = value\n        }\n        break;\n        case \"userEmail\": {\n          this.mailOption.from = value\n        }\n        break;\n        case \"message\": {\n          this.mailOption.text = value;\n        }\n      }\n    });\n\n    form.on('file', (name, file) => {\n      fs.rename(file.path, path.join(form.uploadDir, file.name));\n      let fileDetail = {\n        \"filename\": name,\n        \"path\": \"uploads/\"+name\n      };\n      this.mailOption.attachments.push(fileDetail)\n    });\n\n    form.on('error', err => {\n      console.log('An error has occured: \\n' + err);\n    });\n\n    // once all the files have been uploaded, send a response to the client\n    form.on('end', () => {\n      console.log(\"File uploaded Successfully\");\n      this.nodeMailer.send(this.mailOption)\n        .then(resp => {\n          console.log(\"Mail send Successfully =>>>>>>>>\", resp)\n          res.statusCode = 200;\n          res.send(resp)\n        }, err => {\n          console.log(\"Mail not sent =>>>>>>>\", err);\n          res.statusCode = 500;\n          res.send(err);\n        });\n    });\n\n    // parse the incoming request containing the form data\n    form.parse(req);\n\n  }\n}"]}